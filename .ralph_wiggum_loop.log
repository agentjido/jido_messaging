1) changed files
- `specs/stories/00-runtime-topology-and-slos.md`
- `test/specs/story_00_runtime_topology_and_slos_test.exs`

2) tests/commands executed
- `mix format --check-formatted` (pass)
- `mix compile --warnings-as-errors` (pass)
- `mix test test/specs/story_00_runtime_topology_and_slos_test.exs` (pass, 7 tests)
- `mix test` (pass, 623 tests, 0 failures, 5 skipped)
- `mix precommit` (fails in this environment with Mix PubSub socket `:eperm`)
- `MIX_OS_CONCURRENCY_LOCK=0 elixir -pa /tmp/mix_override_ebin -S mix precommit` (fails with `The task "precommit" could not be found`)

3) acceptance criteria coverage
- AC1 (canonical topology with owner/strategy/restart intensity): implemented in `specs/stories/00-runtime-topology-and-slos.md:9` and matrix at `specs/stories/00-runtime-topology-and-slos.md:35`; validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:20`.
- AC2 (fatal/recoverable/degraded crash matrix with guidance): implemented at `specs/stories/00-runtime-topology-and-slos.md:51`; validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:38`.
- AC3 (SLO baselines + pressure thresholds mapped to telemetry dimensions): implemented at `specs/stories/00-runtime-topology-and-slos.md:69`; validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:54`.
- AC4 (partitioning/sharding guidance for hot-path workers): implemented at `specs/stories/00-runtime-topology-and-slos.md:87`; validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:68`.
- Evidence/traceability checks:
  - ST-OCM-000 row presence validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:91`.
  - downstream Story-00 references validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:98`.
  - architecture review block condition validated by `test/specs/story_00_runtime_topology_and_slos_test.exs:84`.

4) blockers/assumptions
- Blocker: `mix precommit` cannot be left passing in current environment because:
  - plain `mix precommit` fails with Mix PubSub socket permission error (`:eperm`), and
  - with socket workaround, the repo has no `precommit` task/alias defined.
- Assumption: ST-OCM-000 is a documentation contract story; tests were added as documentation contract guards rather than runtime behavior tests.
** (Mix) The task "precommit" could not be found
1) changed files
- `specs/stories/00-runtime-topology-and-slos.md:94`  
Added an explicit hot-path partitioning row for ingest policy workers (Story 04+) in the canonical partition/sharding guidance.
- `test/specs/story_00_runtime_topology_and_slos_test.exs:6`  
Strengthened Story 00 spec tests from string checks to structural validations of topology/crash/SLO/partition tables, architecture review gate requirements, traceability row, and downstream Story 00 dependency references.

2) tests/commands executed
- `mix format specs/stories/00-runtime-topology-and-slos.md test/specs/story_00_runtime_topology_and_slos_test.exs`
- `mix format test/specs/story_00_runtime_topology_and_slos_test.exs`
- `mix test test/specs/story_00_runtime_topology_and_slos_test.exs` (pass)
- `mix precommit` (pass: 623 tests, 0 failures, 5 skipped)

3) acceptance criteria coverage
- AC1 (topology defines owner/supervisor/strategy/restart intensity): validated in `test/specs/story_00_runtime_topology_and_slos_test.exs:50`.
- AC2 (crash matrix with fatal/recoverable/degraded + handling): validated in `test/specs/story_00_runtime_topology_and_slos_test.exs:89`.
- AC3 (SLO baselines + pressure thresholds + telemetry dimensions): validated in `test/specs/story_00_runtime_topology_and_slos_test.exs:128`.
- AC4 (partitioning/sharding guidance for hot-path workers): doc updated at `specs/stories/00-runtime-topology-and-slos.md:94`; validated in `test/specs/story_00_runtime_topology_and_slos_test.exs:178`.
- Verification edge path (block missing crash/topology semantics): validated in `test/specs/story_00_runtime_topology_and_slos_test.exs:215`.
- Evidence of done (traceability row + downstream references): validated in `test/specs/story_00_runtime_topology_and_slos_test.exs:233` and `test/specs/story_00_runtime_topology_and_slos_test.exs:240`.

4) blockers/assumptions
- Blockers: none.
- Assumption: ingest policy execution is part of expected hot-path worker partitioning for `ST-OCM-000`, so it was added explicitly to Story 00 guidance.
Running ExUnit with seed: 513503, max_cases: 20
Excluding tags: [:flaky]

...........................................................................................................................................................................................................................................................................*........................................................................................................................................................................................................................................................*......................................................***.................................................
Finished in 2.2 seconds (0.5s async, 1.6s sync)
623 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/channel.ex`
- `lib/jido_messaging/capabilities.ex`
- `lib/jido_messaging/plugin.ex`
- `lib/jido_messaging/channels/telegram.ex`
- `lib/jido_messaging/channels/discord.ex`
- `lib/jido_messaging/channels/slack.ex`
- `lib/jido_messaging/channels/whatsapp.ex`
- `test/jido_messaging/channel_test.exs`
- `test/jido_messaging/capabilities_test.exs`

2) tests/commands executed
- `mix format`
- `mix test test/jido_messaging/channel_test.exs test/jido_messaging/capabilities_test.exs test/jido_messaging/channels/telegram_test.exs test/jido_messaging/channels/discord_test.exs test/jido_messaging/channels/slack_test.exs test/jido_messaging/channels/whatsapp_test.exs`
- `mix test test/jido_messaging/channel_test.exs test/jido_messaging/capabilities_test.exs`
- `mix precommit` (final run passing: `629 tests, 0 failures, 5 skipped`)

3) acceptance criteria coverage
- AC1: New callbacks are optional with deterministic defaults.
  - Added v2 optional callbacks and default wrappers in `JidoMessaging.Channel` (`listener_child_specs`, `extract_routing_metadata`, `verify_sender`, `sanitize_outbound`, `send_media`, `edit_media`, `extract_command_hint`, `edit_message`).
  - Covered in `test/jido_messaging/channel_test.exs` (`v2 optional callbacks default deterministically for v1-only channels`).
- AC2: First-party channels compile and existing behavior tests remain green.
  - First-party modules updated to `use JidoMessaging.Channel`.
  - `mix precommit` passes with all tests green.
- AC3: Capability declarations align with callback support and are testable.
  - Added `Channel.validate_capability_contract/1` with typed failures.
  - Added compile-time enforcement for modules using `use JidoMessaging.Channel`.
  - Added `:message_edit` only on channels that implement `edit_message/4` (Telegram/Discord/Slack).
  - Covered in `test/jido_messaging/channel_test.exs` (aligned/mismatch/unknown capability tests + first-party validation test).
- AC4: Callback failure classification is explicit.
  - Added typed callback failure envelope (`:class`, `:disposition`, `:reason`) and classification/disposition helpers.
  - Covered in `test/jido_messaging/channel_test.exs` (recoverable timeout => retry, raised exception => fatal/crash).

4) blockers/assumptions
- No blockers.
- Assumed capability atom names for v2 primitives from the story/spec text (no canonical atom list provided).
- Traceability row for `ST-OCM-001` already existed in `specs/stories/00_traceability_matrix.md`, so no matrix edit was needed.
Running ExUnit with seed: 195678, max_cases: 20
Excluding tags: [:flaky]

.................................................................................................................................................................................................................................................*........................................................................................................................................................................................................................................................................................*......................................................***.................................................
Finished in 2.3 seconds (0.5s async, 1.7s sync)
629 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/instance_supervisor.ex:13`
- `lib/jido_messaging/instance_server.ex:31`
- `lib/jido_messaging/instance_reconnect_worker.ex:1` (new)
- `test/jido_messaging/instance_lifecycle_runtime_test.exs:1` (new)

2) tests/commands executed
- `mix format lib/jido_messaging/instance_supervisor.ex lib/jido_messaging/instance_server.ex lib/jido_messaging/instance_reconnect_worker.ex test/jido_messaging/instance_lifecycle_runtime_test.exs`
- `mix compile --warnings-as-errors` (pass)
- `mix test test/jido_messaging/instance_lifecycle_runtime_test.exs test/jido_messaging/instance_supervisor_test.exs test/jido_messaging/instance_server_test.exs test/jido_messaging/health_test.exs` (pass)
- `mix test` (pass, `633 tests, 0 failures, 5 skipped`)
- `mix precommit` (pass, `633 tests, 0 failures, 5 skipped`)

3) acceptance criteria coverage
- AC1 (deterministic startup + child spec resolution): implemented in `InstanceSupervisor.start_instance_tree/2` with explicit channel resolution and ordered children (`InstanceServer`, reconnect worker, listener specs) in `lib/jido_messaging/instance_supervisor.ex:78`; verified by `instance startup resolves listener child specs deterministically and reports health` in `test/jido_messaging/instance_lifecycle_runtime_test.exs:235`.
- AC2 (bounded reconnect + telemetry): implemented in reconnect worker loop/backoff/telemetry in `lib/jido_messaging/instance_reconnect_worker.ex:87` and status hooks in `lib/jido_messaging/instance_server.ex:119`; verified by `recoverable failures trigger bounded reconnect with telemetry` in `test/jido_messaging/instance_lifecycle_runtime_test.exs:266`.
- AC3 (restart intensity + escalation policy): explicit domain/subtree restart limits set in `lib/jido_messaging/instance_supervisor.ex:15` and `lib/jido_messaging/instance_supervisor.ex:98`; crash-loop escalation tested in `test/jido_messaging/instance_lifecycle_runtime_test.exs:338`.
- AC4 (crash isolation across subtrees): isolation behavior tested in `test/jido_messaging/instance_lifecycle_runtime_test.exs:369` by crashing one instance worker and asserting unrelated instance server stays alive.
- Evidence of done (lifecycle/crash-isolation tests): added in `test/jido_messaging/instance_lifecycle_runtime_test.exs:1`.
- Traceability row already existed; no change required in `specs/stories/00_traceability_matrix.md`.

4) blockers/assumptions
- No blockers.
- Assumed supervisor `:DOWN` reason `:shutdown` is acceptable escalation evidence when restart intensity is exceeded, with supervisor PID replacement as the deterministic assertion (`test/jido_messaging/instance_lifecycle_runtime_test.exs:357`).
Running ExUnit with seed: 14690, max_cases: 20
Excluding tags: [:flaky]

............................................................................................................................................................................................................................................*.............................................................................................................................................................................................................................................................................................*..........................................................***.................................................
Finished in 3.4 seconds (0.4s async, 2.9s sync)
633 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/outbound_gateway.ex`
- `lib/jido_messaging/outbound_gateway/supervisor.ex`
- `lib/jido_messaging/outbound_gateway/partition.ex`
- `lib/jido_messaging/supervisor.ex`
- `lib/jido_messaging/deliver.ex`
- `test/jido_messaging/outbound_gateway_test.exs`
- `test/jido_messaging/deliver_test.exs`

2) tests/commands executed
- `mix format`
- `mix test test/jido_messaging/outbound_gateway_test.exs test/jido_messaging/deliver_test.exs test/jido_messaging/signal_test.exs`
- `mix precommit` (passed; 640 tests, 0 failures, 5 skipped)

3) acceptance criteria coverage
- AC1 (`Deliver` sends/edits through gateway APIs only):
  - `Deliver.deliver_outgoing/5` and `Deliver.send_to_room/5` now route through `JidoMessaging.OutboundGateway.send_message/4`.
  - Added `Deliver.edit_outgoing/5`, routed through `JidoMessaging.OutboundGateway.edit_message/5`.
  - `test/jido_messaging/deliver_test.exs` asserts send/edit gateway metadata + outbound completion telemetry.
- AC2 (partitioned workers with stable routing key):
  - Added partitioned gateway worker pool (`OutboundGateway.Supervisor` + `OutboundGateway.Partition`).
  - Stable route key: `instance_id <> ":" <> external_room_id` hashed via `route_partition/3`.
  - `test/jido_messaging/outbound_gateway_test.exs` verifies multi-room distribution and stable partition assignment.
- AC3 (queue bounds + pressure signals):
  - Per-partition bounded queue (`queue_capacity`) with `:queue_full` rejection.
  - Pressure transition telemetry on `[:jido_messaging, :pressure, :transition]` with level changes (`:normal/:warn/:degraded/:shed`).
  - `test/jido_messaging/outbound_gateway_test.exs` verifies queue rejection and `:shed` pressure transition.
- AC4 (normalized error categories for retry/terminal handling):
  - Added normalized taxonomy (`:retryable | :terminal | :fatal`) in gateway classification.
  - Retry loop only for retryable failures with bounded attempts/backoff.
  - Classification telemetry emitted on `[:jido_messaging, :outbound, :classified_error]`.
  - `test/jido_messaging/outbound_gateway_test.exs` verifies retryable classification, bounded retry behavior, and terminal give-up envelope.

4) blockers/assumptions
- No blockers.
- Assumption: scope for this story is `Deliver` integration; `Streaming`’s direct channel edit path was left unchanged.
Running ExUnit with seed: 600915, max_cases: 20
Excluding tags: [:flaky]

...............................................................................................................................................................................................................................................................*......................................................................................................................................................................................................................................................................*.....................................................................***.................................................
Finished in 3.2 seconds (0.8s async, 2.4s sync)
640 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/ingest.ex:53`  
  Added ingest policy pipeline support with `ingest_incoming/5` and `ingest_incoming!/5` options, deterministic `gating -> moderation` execution before persistence/signals, bounded per-module timeouts, timeout/error fallback policy (`:deny` or `:allow_with_flag`), policy telemetry (`[:jido_messaging, :ingest, :policy, :decision]`), and persisted policy metadata (`metadata.policy.decisions/flags/modified/flagged`).
- `test/jido_messaging/ingest_test.exs:274`  
  Added ST-OCM-004 coverage tests for deterministic order, deny short-circuit, timeout handling/fallback, modify+flag metadata preservation, policy telemetry emission, and configured-policy happy path.

2) tests/commands executed
- `mix format` (pass)
- `mix test test/jido_messaging/ingest_test.exs` (pass, 13 tests)
- `mix test test/jido_messaging/gating_test.exs test/jido_messaging/moderation_test.exs` (pass, 36 tests)
- `mix precommit` (pass, 646 tests, 0 failures, 5 skipped)

3) acceptance criteria coverage
- AC1 (`gating then moderation order deterministic and configurable`):  
  Covered by `test/jido_messaging/ingest_test.exs:275` (`runs gating before moderation deterministically with configured modules`), asserting configured modules run in `[:gating, :moderation]` order.
- AC2 (`denied messages not persisted, no room/agent events`):  
  Covered by `test/jido_messaging/ingest_test.exs:297`, asserting `{:policy_denied, ...}`, no persisted message, and no `:room/:message_added` or `:message/:received` telemetry for this instance.
- AC3 (`policy hooks bounded by timeout budgets`):  
  Covered by `test/jido_messaging/ingest_test.exs:338` (timeout denies quickly under configured timeout) and `test/jido_messaging/ingest_test.exs:360` (timeout fallback `:allow_with_flag` continues ingest without deadlock).
- AC4 (`modified/flagged preserve metadata and emit policy telemetry`):  
  Covered by `test/jido_messaging/ingest_test.exs:385`, asserting original metadata preservation, modification + flags persisted in `metadata.policy`, and policy telemetry events for `:modify` and `:flag` outcomes.

4) blockers/assumptions
- Blockers: none.
- Assumption: “deterministic and configurable” is satisfied by deterministic stage order (`gating` then `moderation`) with configurable module lists/options and fallback policy.
Running ExUnit with seed: 329550, max_cases: 20
Excluding tags: [:flaky]

.........................................................................................................................................................................................................................*..................................................................................................................................................................................................................................................................................................................*.....................................................................***.................................................
Finished in 3.2 seconds (0.8s async, 2.3s sync)
646 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/security.ex`
- `lib/jido_messaging/security/default_adapter.ex`
- `lib/jido_messaging/ingest.ex`
- `lib/jido_messaging/outbound_gateway/partition.ex`
- `lib/jido_messaging/outbound_gateway.ex`
- `lib/jido_messaging/deliver.ex`
- `test/jido_messaging/security_test.exs`
- `test/jido_messaging/ingest_test.exs`
- `test/jido_messaging/outbound_gateway_test.exs`
- `test/jido_messaging/deliver_test.exs`

2) tests/commands executed
- `mix format`
- `mix test test/jido_messaging/security_test.exs test/jido_messaging/ingest_test.exs test/jido_messaging/outbound_gateway_test.exs test/jido_messaging/deliver_test.exs`
- `mix precommit` (pass: 660 tests, 0 failures, 5 skipped)

3) acceptance criteria coverage
- AC1 Inbound verification deny untrusted sender:
  - Central verify added in `JidoMessaging.Security` and enforced in `Ingest` before persistence.
  - Covered by `test/jido_messaging/ingest_test.exs` (`spoofed sender claim is denied...`) and `test/jido_messaging/security_test.exs` (`denies spoofed sender claim...`).
- AC2 Outbound sanitization deterministic per-channel:
  - Central sanitize enforced in outbound partition before send/edit.
  - Deterministic channel rules implemented in default adapter (`slack`/`discord` mass-mention neutralization + normalization).
  - Covered by `test/jido_messaging/outbound_gateway_test.exs` (`applies deterministic per-channel outbound sanitization...`) and `test/jido_messaging/security_test.exs`.
- AC3 Failure classification + explicit policy handling:
  - Added typed classifications (`:deny`, `:retry`, `:degrade`) and policy controls (`verify_failure_policy`, `sanitize_failure_policy`).
  - Timeout/error fallback behavior covered in:
    - `test/jido_messaging/security_test.exs` (verify deny-on-timeout, sanitize allow_original fallback)
    - `test/jido_messaging/ingest_test.exs` (verify timeout deny)
    - `test/jido_messaging/outbound_gateway_test.exs` (sanitize timeout deny/allow_original)
    - `test/jido_messaging/deliver_test.exs` (typed sanitize timeout denial surfaced)
- AC4 Bounded + observable checks:
  - Checks run with timeout budgets in `JidoMessaging.Security`.
  - Decision telemetry emitted on `[:jido_messaging, :security, :decision]`.
  - Bounded timing + telemetry validated in `test/jido_messaging/security_test.exs`.
- Traceability row:
  - Existing `ST-OCM-005` row already present in `specs/stories/00_traceability_matrix.md` (no change needed).

4) blockers/assumptions
- Blockers: none.
- Assumptions:
  - Runtime security overrides are provided via `security: [...]` options on ingest/outbound calls.
  - Default mode remains permissive for compatibility; strict behavior is opt-in via policy config.
Running ExUnit with seed: 929690, max_cases: 20
Excluding tags: [:flaky]

..........................................................................................................................................................................................................................*..........................................................................................................................................................................................................................................................................................................................*..........................................................................***.................................................
Finished in 3.5 seconds (0.8s async, 2.6s sync)
660 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/session_manager.ex` (new)
- `lib/jido_messaging/session_manager/partition.ex` (new)
- `lib/jido_messaging/session_manager/supervisor.ex` (new)
- `lib/jido_messaging/supervisor.ex`
- `lib/jido_messaging/ingest.ex`
- `lib/jido_messaging/outbound_gateway.ex`
- `lib/jido_messaging/outbound_gateway/partition.ex`
- `lib/jido_messaging/deliver.ex`
- `lib/jido_messaging.ex`
- `test/jido_messaging/session_manager_test.exs` (new)

2) tests/commands executed
- `mix format`
- `mix test test/jido_messaging/session_manager_test.exs`
- `mix test test/jido_messaging/ingest_test.exs test/jido_messaging/outbound_gateway_test.exs test/jido_messaging/deliver_test.exs`
- `mix precommit` (initial run failed formatting check on new test file)
- `mix format test/jido_messaging/session_manager_test.exs`
- `mix precommit` (passing; `664 tests, 0 failures, 5 skipped`)

3) acceptance criteria coverage
- AC1 partitioned route state:
  - Added partitioned `JidoMessaging.SessionManager` with hash-based shard routing and per-partition workers under `JidoMessaging.SessionManager.Supervisor`.
  - Added root supervision wiring in `JidoMessaging.Supervisor`.
  - Covered by `test/jido_messaging/session_manager_test.exs` test: `"partitions route state with deterministic hash resolution and hit telemetry"`.
- AC2 TTL + eviction:
  - Added TTL expiry checks, periodic pruning, and bounded-capacity eviction in `SessionManager.Partition`.
  - Covered by `test/jido_messaging/session_manager_test.exs` test: `"enforces TTL expiration and bounded eviction to prevent unbounded growth"`.
- AC3 outbound uses route state with stale fallback:
  - `Ingest` now writes session route state after successful inbound processing.
  - `OutboundGateway` now resolves route via `SessionManager.resolve/3` before dispatch and falls back when stale/unavailable.
  - Added fallback/hit/stale telemetry and surfaced route resolution in outbound metadata.
  - Covered by `test/jido_messaging/session_manager_test.exs` test: `"outbound resolution uses session route state and stale-route fallback telemetry"`.
- AC4 crash recovery via supervision:
  - Session manager partitions are supervised with one-for-one restart under root tree.
  - Covered by `test/jido_messaging/session_manager_test.exs` test: `"partition crashes recover via supervision without global routing outage"`.

4) blockers/assumptions
- Blockers: none.
- Assumption: stale/missing route fallback uses the outbound context’s provided `external_room_id` as the valid alternative route.
Running ExUnit with seed: 237707, max_cases: 20
Excluding tags: [:flaky]

...............................................................................................................................................................................................................................................*.....................................................................................................................................................................................................................................................................................................*..........................................................................***.....................................................
Finished in 3.8 seconds (0.8s async, 2.9s sync)
664 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/media_policy.ex` (new)
- `lib/jido_messaging/ingest.ex`
- `lib/jido_messaging/outbound_gateway.ex`
- `lib/jido_messaging/outbound_gateway/partition.ex`
- `lib/jido_messaging/deliver.ex`
- `lib/jido_messaging/channel.ex`
- `lib/jido_messaging/channels/discord.ex`
- `lib/jido_messaging/channels/telegram.ex`
- `lib/jido_messaging/channels/slack.ex`
- `lib/jido_messaging/channels/whatsapp.ex`
- `test/jido_messaging/ingest_test.exs`
- `test/jido_messaging/outbound_gateway_test.exs`
- `test/jido_messaging/deliver_test.exs`
- `test/jido_messaging/channels/discord_test.exs`
- `test/jido_messaging/channels/telegram_test.exs`
- `test/jido_messaging/channels/slack_test.exs`
- `test/jido_messaging/channels/whatsapp_test.exs`

2) tests/commands executed
- `mix compile`
- `mix test test/jido_messaging/ingest_test.exs test/jido_messaging/deliver_test.exs test/jido_messaging/outbound_gateway_test.exs test/jido_messaging/channels/discord_test.exs test/jido_messaging/channels/telegram_test.exs test/jido_messaging/channels/slack_test.exs test/jido_messaging/channels/whatsapp_test.exs`
- `mix test`
- `mix format lib/jido_messaging/media_policy.ex lib/jido_messaging/outbound_gateway/partition.ex test/jido_messaging/ingest_test.exs`
- `mix precommit` (passing)

3) acceptance criteria coverage
- AC1 Inbound payloads map to canonical media blocks:
  - Added `MediaPolicy.normalize_inbound/2` and wired ingest content building to produce canonical `%Content.Image{}`, `%Content.Audio{}`, `%Content.Video{}`, `%Content.File{}`.
  - Extended first-party channel transforms to extract inbound media into `incoming[:media]`.
  - Covered by new tests in `test/jido_messaging/ingest_test.exs` and channel mapper tests.
- AC2 Outbound media operations route through gateway capability checks:
  - Added `OutboundGateway.send_media/4` and `OutboundGateway.edit_media/5`.
  - Partition preflight now checks channel media capability + required media callback before dispatch.
  - Covered by new gateway tests in `test/jido_messaging/outbound_gateway_test.exs`.
- AC3 Type/size limits enforce bounded resource usage:
  - Added bounded media policy (`max_items`, `max_item_bytes`, `max_total_bytes`, media-type checks) in `MediaPolicy`.
  - Enforced in both ingest and outbound media preflight.
  - Covered by inbound and outbound limit tests.
- AC4 Unsupported media paths deterministic fallback/reject:
  - Implemented deterministic unsupported policy: `:reject` or `:fallback_text`.
  - Fallback routes to text send/edit operations; reject returns typed terminal errors.
  - Covered by new outbound gateway tests and deliver media fallback test.

4) blockers/assumptions
- Blockers: none.
- Assumptions:
  - Canonical inbound media shape is `incoming[:media]` as a list of maps with `kind` + media attributes.
  - First-party channels now parse inbound media, but outbound media callbacks are still channel-specific; channels without `send_media/edit_media` deterministically reject or fallback per policy.
  - Traceability row for `ST-OCM-007` already existed in `specs/stories/00_traceability_matrix.md`, so no change was needed.
Running ExUnit with seed: 25252, max_cases: 20
Excluding tags: [:flaky]

......................................................................................................................................................................................................................................................................*...................................................................................................................................................................................................................................................................................*................................................................................***.....................................................
Finished in 3.8 seconds (0.8s async, 3.0s sync)
675 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging/ingest.ex`
- `lib/jido_messaging/adapters/mentions.ex`
- `lib/jido_messaging/msg_context/command_parser.ex`
- `lib/jido_messaging/msg_context/normalizer.ex`
- `lib/jido_messaging/channels/telegram/mentions.ex`
- `lib/jido_messaging/channels/discord/mentions.ex`
- `lib/jido_messaging/channels/slack/mentions.ex`
- `lib/jido_messaging/channels/whatsapp/mentions.ex`
- `test/jido_messaging/ingest_test.exs`
- `test/jido_messaging/adapters/mentions_test.exs`
- `test/jido_messaging/channels/mentions_normalization_test.exs`
- `test/jido_messaging/msg_context/command_parser_test.exs`

2) tests/commands executed
- `mix format`
- `mix compile --warnings-as-errors`
- `mix test test/jido_messaging/msg_context/command_parser_test.exs`
- `mix test test/jido_messaging/channels/mentions_normalization_test.exs`
- `mix test test/jido_messaging/adapters/mentions_test.exs`
- `mix test test/jido_messaging/ingest_test.exs`
- `mix precommit` (pass: `691 tests, 0 failures, 5 skipped`)

3) acceptance criteria coverage
- AC1 deterministic command parse across channels:
  - Added bounded deterministic parser in `lib/jido_messaging/msg_context/command_parser.ex`.
  - Cross-channel normalization test in `test/jido_messaging/ingest_test.exs` asserts equivalent parsed command/mention outputs for equivalent inputs.
- AC2 normalized mention metadata and `was_mentioned`:
  - Added canonical mention normalization in `lib/jido_messaging/adapters/mentions.ex`.
  - Added first-party mention adapters:
    - `lib/jido_messaging/channels/telegram/mentions.ex`
    - `lib/jido_messaging/channels/discord/mentions.ex`
    - `lib/jido_messaging/channels/slack/mentions.ex`
    - `lib/jido_messaging/channels/whatsapp/mentions.ex`
  - Wired into ingest via `lib/jido_messaging/msg_context/normalizer.ex` and `lib/jido_messaging/ingest.ex`.
- AC3 require-mention and allowed-prefix enforceable in ingest:
  - Enforced in `lib/jido_messaging/ingest.ex` (`require_mention`, `allowed_prefixes`) with typed denial reasons.
  - Verified in `test/jido_messaging/ingest_test.exs`.
- AC4 bounded-cost parsing and safe failures:
  - Max text bounds in parser (`command_max_text_bytes`) with typed reasons (`:text_too_long`, etc.).
  - Verified in `test/jido_messaging/msg_context/command_parser_test.exs` and ingest edge-path test in `test/jido_messaging/ingest_test.exs`.

4) blockers/assumptions
- Blockers: none.
- Assumptions:
  - `:mention_targets` should be provided for reliable bot-target mention semantics; fallback target is `instance_id`.
  - `:allowed_prefixes` is enforced only when a command is successfully parsed (`status: :ok`).
Running ExUnit with seed: 836898, max_cases: 20
Excluding tags: [:flaky]

....................................................................................................................................................................................................................................................*.....................................................................................................................................................................................................................................................................................................................*................................................................................***.....................................................
Finished in 3.8 seconds (0.8s async, 3.0s sync)
691 tests, 0 failures, 5 skipped
1) changed files
- `lib/jido_messaging.ex`
- `lib/jido_messaging/adapter.ex`
- `lib/jido_messaging/adapters/ets.ex`
- `lib/jido_messaging/supervisor.ex`
- `lib/jido_messaging/directory.ex`
- `lib/jido_messaging/onboarding.ex`
- `lib/jido_messaging/onboarding/flow.ex`
- `lib/jido_messaging/onboarding/state_machine.ex`
- `lib/jido_messaging/onboarding/supervisor.ex`
- `lib/jido_messaging/onboarding/worker.ex`
- `test/jido_messaging/adapters/ets_test.exs`
- `test/jido_messaging/directory_test.exs`
- `test/jido_messaging/onboarding_test.exs`

2) tests/commands executed
- `mix test test/jido_messaging/adapters/ets_test.exs test/jido_messaging/directory_test.exs test/jido_messaging/onboarding_test.exs`
- `mix format`
- `mix test test/jido_messaging/adapters/ets_test.exs test/jido_messaging/directory_test.exs test/jido_messaging/onboarding_test.exs`
- `mix precommit` (passing: 700 tests, 0 failures, 5 skipped)

3) acceptance criteria coverage
- AC1 (Directory lookup/search consistent adapter contract):
  - Added directory contract callbacks on adapter and unified API via `JidoMessaging.Directory`.
  - Implemented deterministic lookup/search behavior (including `{:ambiguous, matches}`) in ETS adapter.
  - Covered by `test/jido_messaging/directory_test.exs` and `test/jido_messaging/adapters/ets_test.exs`.
- AC2 (Deterministic, validated, idempotent onboarding transitions):
  - Added explicit transition map/guards in `JidoMessaging.Onboarding.StateMachine`.
  - Added persisted idempotency-key handling to prevent duplicate side effects.
  - Covered by `test/jido_messaging/onboarding_test.exs` (“invalid transitions…”, “happy path…”).
- AC3 (Resume after interruption):
  - Added persisted onboarding flow storage and `resume_onboarding` path loading persisted state.
  - Covered by `test/jido_messaging/onboarding_test.exs` (“resume restores persisted state…”).
- AC4 (Supervised workers + crash isolation):
  - Added `JidoMessaging.Onboarding.Supervisor` (DynamicSupervisor) and worker registry wiring in root supervisor.
  - Per-flow worker processes are isolated by onboarding ID.
  - Covered by `test/jido_messaging/onboarding_test.exs` (“worker crashes are isolated…”).

4) blockers/assumptions
- No blockers.
- Assumption: onboarding flow is intentionally linear for MVP (`:started -> :directory_resolved -> :paired -> :completed`, with `:cancel` from non-terminal states).
- Assumption: traceability row for `ST-OCM-009` already existed in `specs/stories/00_traceability_matrix.md`, so no update was needed.
Running ExUnit with seed: 124212, max_cases: 20
Excluding tags: [:flaky]

.............................................................................................................................................................................................................................................................*.................................................................................................................................................................................................................................................................................................................*....................................................................................***.....................................................
Finished in 3.9 seconds (0.8s async, 3.1s sync)
700 tests, 0 failures, 5 skipped
